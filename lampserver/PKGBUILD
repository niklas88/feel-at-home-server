# Maintainer: Niklas Schnelle <niklas@komani.de>

pkgname=lampserver
pkgver=0.1
pkgrel=1
pkgdesc="Server for lamps"
arch=('x86_64' 'i686' 'armv6h')
#url="http://SERVER/$pkgname/"
license=('GPL')
#makedepends=('go')
options=('!strip' '!emptydirs')
source=("$pkgname.service" "$pkgname.socket" "lampgit::git+ssh://uni@sceneproject.org/home/uni/lamp.git")

build() {
  # "self contained build" for people who don't have GOPATH set:
  # set GOPATH to $srcdir/go
  # put lampserver git repository in $srcdir/go/src/lamp/lampserver
  # then go get and go build
  unset GOROOT
  export GOPATH="$PWD/go"
  rm -rf go/src
  mkdir -p go/src
  mv lampgit go/src/lamp
  cd go/src/lamp/lampserver

  go get
  go build
}

package() {
  install -Dm655 "$pkgname.service" "$pkgdir/usr/lib/systemd/system/$pkgname.service"
  install -Dm655 "$pkgname.socket" "$pkgdir/usr/lib/systemd/system/$pkgname.socket"

  cd go/src/lamp/lampserver
  install -Dm755 "$pkgname" "$pkgdir/usr/bin/$pkgname"
  install -Dm655 "config.json" "$pkgdir/etc/lampserver/config.json"
}

